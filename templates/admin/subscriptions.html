{% extends "base.html" %}
{% block title %}Manage Subscriptions{% endblock %}

{% block content %}
<h1 class="text-xl font-bold mb-4">Subscription Management</h1>

<div class="space-y-4">

  {% for user in users %}
  <div class="p-4 bg-black/20 border border-white/10 rounded">

    <div class="flex justify-between items-center">
      <div>
        <div class="font-semibold">{{ user.email }}</div>
        <div class="text-sm text-white/60">
          Role: {{ user.role }}
        </div>

        {% if sub_map.get(user.id) %}
          <div class="mt-1 text-green-400 text-sm">
            Active: {{ sub_map.get(user.id).role }} / {{ sub_map.get(user.id).tier }}
          </div>
        {% else %}
          <div class="mt-1 text-red-400 text-sm">
            No active subscription
          </div>
        {% endif %}
      </div>

      <div class="flex gap-2">

        <form method="POST" action="{{ url_for('admin_set_subscription') }}">
          <input type="hidden" name="user_id" value="{{ user.id }}">
          <input type="hidden" name="role" value="{{ user.role }}">
          <input type="hidden" name="tier" value="basic">
          <button class="px-3 py-1 bg-yellow-600 hover:bg-yellow-500 rounded text-sm">
            Set Basic
          </button>
        </form>

        <form method="POST" action="{{ url_for('admin_set_subscription') }}">
          <input type="hidden" name="user_id" value="{{ user.id }}">
          <input type="hidden" name="role" value="{{ user.role }}">
          <input type="hidden" name="tier" value="premium">
          <button class="px-3 py-1 bg-green-700 hover:bg-green-600 rounded text-sm">
            Set Premium
          </button>
        </form>

        <form method="POST" action="{{ url_for('admin_clear_subscription', user_id=user.id) }}">
          <input type="hidden" name="user_id" value="{{ user.id }}">
          <button class="px-3 py-1 bg-red-700 hover:bg-red-600 rounded text-sm">
            Clear
          </button>
        </form>

      </div>
    </div>

  </div>
  {% endfor %}

</div>

{% endblock %}
