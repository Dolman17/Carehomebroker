{% extends "base.html" %}
{% block title %}Deal – Introduction #{{ introduction.id }}{% endblock %}

{% block content %}
<div class="max-w-xl mx-auto text-white">
  <div class="flex items-center justify-between mb-4">
    <div>
      <h1 class="text-xl font-semibold">Deal details</h1>
      <p class="text-[11px] text-white/60 mt-1">
        {{ introduction.listing.listing_code or "Ref " ~ introduction.listing.id }} –
        {{ introduction.listing.title }}
      </p>
    </div>
    <a href="{{ url_for('admin_introduction_detail', intro_id=introduction.id) }}"
       class="text-[11px] border border-white/30 text-white/80 px-3 py-1.5 rounded hover:bg-white/10">
      ← Back to introduction
    </a>
  </div>

  <form method="post"
        class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-4 text-xs">

    <div>
      <label class="block text-[11px] font-semibold mb-1" for="agreed_price">
        Agreed price (headline)
      </label>
      <input type="text" id="agreed_price" name="agreed_price"
             value="{{ deal.agreed_price or '' }}"
             placeholder="e.g. £3,250,000"
             class="w-full bg-black/30 border border-white/20 rounded px-3 py-2 text-xs text-white">
      <p class="text-[10px] text-white/60 mt-1">
        Free text – numbers will be parsed where possible to auto-calc commission.
      </p>
    </div>

    <div class="grid grid-cols-2 gap-3">
      <div>
        <label class="block text-[11px] font-semibold mb-1" for="broker_commission_percent">
          Broker commission %
        </label>
        <input type="number" step="0.01" min="0" id="broker_commission_percent"
               name="broker_commission_percent"
               value="{{ deal.broker_commission_percent or 2.0 }}"
               class="w-full bg-black/30 border border-white/20 rounded px-3 py-2 text-xs text-white">
      </div>

      <div>
        <label class="block text-[11px] font-semibold mb-1" for="completion_date">
          Completion date
        </label>
        <input type="date" id="completion_date" name="completion_date"
               value="{{ deal.completion_date.strftime('%Y-%m-%d') if deal.completion_date else '' }}"
               class="w-full bg-black/30 border border-white/20 rounded px-3 py-2 text-xs text-white">
      </div>
    </div>

    {% if deal.broker_commission_amount %}
      <div class="text-[11px] text-kaijoYellow mt-1">
        Current commission value:
        £{{ "%.2f"|format(deal.broker_commission_amount / 100) }}
      </div>
    {% endif %}

    <div class="pt-2 flex items-center justify-between">
      <button type="submit"
              class="px-4 py-2 rounded bg-kaijoPink text-[11px] font-semibold hover:bg-kaijoYellow hover:text-black transition">
        Save deal
      </button>
      <p class="text-[10px] text-white/50">
        Marking a completion date will also set the deal as <span class="italic">completed</span>.
      </p>
    </div>
  </form>
</div>
{% endblock %}
