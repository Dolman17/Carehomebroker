{% extends "base.html" %}
{% block title %}Seller Dashboard{% endblock %}

{% block content %}
<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 gap-3">
  <div>
    <h1 class="text-xl font-semibold text-kaijoYellow mb-1">Seller Dashboard</h1>
    <p class="text-xs text-white/70">Manage your listings & enquiries</p>
  </div>

  <a href="{{ url_for('seller_new_listing') }}"
     class="text-xs bg-kaijoPink text-white px-3 py-2 rounded hover:bg-kaijoYellow hover:text-black transition">
    + New Listing
  </a>
</div>

{% if listings %}
  <div class="space-y-4">
    {% for l in listings %}
      <div class="bg-white/5 border border-white/10 backdrop-blur-sm rounded-lg p-4 space-y-3 shadow-[0_0_20px_rgba(0,0,0,0.35)]">

        <div class="flex gap-3">

          {# Cover photo #}
          {% set cover = l.photos|selectattr('is_cover')|list|first %}
          {% if not cover and l.photos %}
            {% set cover = l.photos[0] %}
          {% endif %}

          {% if cover %}
            <img src="{{ url_for('static', filename='uploads/' ~ cover.filename) }}"
                 class="w-20 h-16 object-cover rounded border border-white/20">
          {% endif %}

          <div class="flex-1 flex flex-col sm:flex-row sm:items-center sm:justify-between">

            <div>
              <p class="text-xs text-white/40 font-mono">{{ l.listing_code }}</p>
              <p class="font-semibold text-sm text-white">{{ l.title }}</p>
              <p class="text-xs text-white/60">
                {{ l.region }} • {{ l.care_type }} • {{ l.beds or "?" }} beds
              </p>

              {% if l.photos|length > 1 %}
                <p class="text-[11px] text-white/50 mt-1">
                  {{ l.photos|length }} photos
                </p>
              {% endif %}
            </div>

            <div class="mt-2 sm:mt-0 flex flex-col items-start sm:items-end">

              <span class="px-2 py-1 text-[11px] rounded
                {% if l.status == 'draft' %} bg-white/10 text-white/70
                {% elif l.status == 'live' %} bg-green-600/30 text-green-300
                {% elif l.status == 'under_offer' %} bg-yellow-600/30 text-kaijoYellow
                {% elif l.status == 'sold' %} bg-kaijoPurple/40 text-kaijoPurple
                {% endif %}">
                {{ l.status|replace('_',' ')|title }}
              </span>

              <p class="text-[11px] text-white/50 mt-1">
                {{ l.total_enquiries }} enquiries
              </p>
            </div>

          </div>
        </div>

        <!-- BUTTONS -->
        <div class="flex flex-wrap gap-2 text-xs">

          <a href="{{ url_for('seller_edit_listing', listing_id=l.id) }}"
             class="border border-white/20 text-white/80 px-3 py-1 rounded hover:bg-white/10 hover:text-kaijoYellow transition">
            Edit
          </a>

          {% for status,label in [
            ('draft','Mark Draft'),
            ('live','Mark Live'),
            ('under_offer','Under Offer'),
            ('sold','Sold')
          ] %}
          <form method="post" action="{{ url_for('seller_update_listing_status', listing_id=l.id) }}">
            <input type="hidden" name="status" value="{{ status }}">
            <button
              class="border border-white/20 text-white/80 px-3 py-1 rounded hover:bg-white/10 hover:text-kaijoPink transition">
              {{ label }}
            </button>
          </form>
          {% endfor %}

        </div>

      </div>
    {% endfor %}
  </div>
{% else %}
  <p class="text-sm text-white/70">You have no listings yet.</p>
{% endif %}
{% endblock %}
